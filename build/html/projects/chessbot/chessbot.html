<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Chess Bot &#8212; Mark Zimmerman&#39;s Portfolio 0.0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=d1102ebc" />
    <link rel="stylesheet" type="text/css" href="../../_static/basic.css?v=c058f7c8" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css?v=e480df4b" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
    <script src="../../_static/documentation_options.js?v=d45e8c67"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Kaggle Competitions" href="../kaggle/kaggle.html" />
    <link rel="prev" title="Mark Zimmerman’s Portfolio" href="../../index.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="../../index.html">
    <img class="logo" src="../../_static/logo.png" alt="Logo" />
    
  </a>
</p>



<p class="blurb">A demonstration of exploits in Data Science and Machine Learning Engineering.</p>







<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
<ul style="list-style-type: '➤';">
    
    
        <li class="toctree-l1"><a href="https://www.linkedin.com/in/mark-zimmerman-122b1a60/">LinkedIn</a></li>
    
    
    
        <li class="toctree-l1"><a href="https://www.github.com/mzimm003">GitHub</a></li>
    
    
    
        <li class="toctree-l1"><a href="../../_static/Mark_Zimmerman_Resume.pdf">Resume</a></li>
    
    
</ul>
<hr />

<h4>Navigation</h4>
<p class="caption" role="heading"><span class="caption-text">Projects:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Chess Bot</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#play-a-bot">Play A Bot</a></li>
<li class="toctree-l2"><a class="reference internal" href="#data-engineering">Data Engineering</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#data-gathering">Data Gathering</a></li>
<li class="toctree-l3"><a class="reference internal" href="#data-preprocessing">Data Preprocessing</a></li>
<li class="toctree-l3"><a class="reference internal" href="#the-stats">The Stats</a></li>
<li class="toctree-l3"><a class="reference internal" href="#the-tricky-bit">The Tricky Bit</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#machine-learning-engineering">Machine Learning Engineering</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#supervised-learning">Supervised Learning</a></li>
<li class="toctree-l3"><a class="reference internal" href="#reinforcement-learning">Reinforcement Learning</a></li>
<li class="toctree-l3"><a class="reference internal" href="#generative-model">Generative Model</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#references">References:</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../kaggle/kaggle.html">Kaggle Competitions</a></li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
      <li>Previous: <a href="../../index.html" title="previous chapter">Mark Zimmerman’s Portfolio</a></li>
      <li>Next: <a href="../kaggle/kaggle.html" title="next chapter">Kaggle Competitions</a></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="chess-bot">
<span id="id1"></span><h1>Chess Bot<a class="headerlink" href="#chess-bot" title="Link to this heading">¶</a></h1>
<p>
<iframe src="https://ghbtns.com/github-btn.html?user=mzimm003&repo=Chess&type=watch&count=true&size=large&v=2"
allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p><section id="play-a-bot">
<h2>Play A Bot<a class="headerlink" href="#play-a-bot" title="Link to this heading">¶</a></h2>
<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3">
<summary class="sd-summary-title sd-card-header">
<span class="sd-summary-text">App</span><span class="sd-summary-state-marker sd-summary-chevron-right"><svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-right" viewBox="0 0 24 24" aria-hidden="true"><path d="M8.72 18.78a.75.75 0 0 1 0-1.06L14.44 12 8.72 6.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018l6.25 6.25a.75.75 0 0 1 0 1.06l-6.25 6.25a.75.75 0 0 1-1.06 0Z"></path></svg></span></summary><div class="sd-summary-content sd-card-body docutils">
<p class="sd-card-text">Select a bot to play. Learn more about their construction below.</p>
<p>
<iframe
src="https://mzimm003-playchessvsai.hf.space"
frameborder="0"
width="1200"
height="1100"
></iframe>
</p></div>
</details></section>
<section id="data-engineering">
<h2>Data Engineering<a class="headerlink" href="#data-engineering" title="Link to this heading">¶</a></h2>
<p>The goal of the database supporting our chess bot is to have a large number of
examples from strong players. Further, it is important that the data is
easily understood by a machine. Then it is adequate to obtain millions of
chess board positions reached by high Elo players where the outcome of the game
is known. The board positions can then effectively be represented as a series of
yes of no statements, mostly regarding each piece and its position within the 8x8
chess board.</p>
<section id="data-gathering">
<h3>Data Gathering<a class="headerlink" href="#data-gathering" title="Link to this heading">¶</a></h3>
<p>To achieve so many board positions from high Elo players,
<a class="reference external" href="http://computerchess.org.uk/ccrl/404/index.html">Computer Chess Rating Lists</a>
records millions of games from top chess engines in Portable Game Notation (PGN)
format. These are freely available for download in a compressed format.</p>
</section>
<section id="data-preprocessing">
<h3>Data Preprocessing<a class="headerlink" href="#data-preprocessing" title="Link to this heading">¶</a></h3>
<p>Getting the board positions necessary requires recreating the games played per
the PGN files. <a class="reference external" href="https://github.com/Farama-Foundation/PettingZoo">PettingZoo</a>,
provided by Farama Foundation, includes a chess environment. This environment
provides observations of the state of the chess board. The specifics can be
found <a class="reference external" href="https://pettingzoo.farama.org/environments/classic/chess/">here</a>. In
short, the observation is a set of board representations, also referred to as
channels. Each representation is an 8x8 matrix of zeros and ones,
‘no’s and ‘yes’s, with respect to a specific piece of information, like
“are there white pawns in this position”. There are a few pieces of information
worth clarifying from the PettingZoo documentation so I will include the
channel specifications here:</p>
<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3">
<summary class="sd-summary-title sd-card-header">
<span class="sd-summary-text">PettingZoo Chess Observation Channels</span><span class="sd-summary-state-marker sd-summary-chevron-right"><svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-right" viewBox="0 0 24 24" aria-hidden="true"><path d="M8.72 18.78a.75.75 0 0 1 0-1.06L14.44 12 8.72 6.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018l6.25 6.25a.75.75 0 0 1 0 1.06l-6.25 6.25a.75.75 0 0 1-1.06 0Z"></path></svg></span></summary><div class="sd-summary-content sd-card-body docutils">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p class="sd-card-text">Channel</p></th>
<th class="head"><p class="sd-card-text">Information</p></th>
<th class="head"><p class="sd-card-text">Specification</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p class="sd-card-text">0</p></td>
<td><p class="sd-card-text">Can white castle queenside?</p></td>
<td><p class="sd-card-text">Non-positional, all ones or all zeros</p></td>
</tr>
<tr class="row-odd"><td><p class="sd-card-text">1</p></td>
<td><p class="sd-card-text">Can white castle kingside?</p></td>
<td><p class="sd-card-text">Non-positional, all ones or all zeros</p></td>
</tr>
<tr class="row-even"><td><p class="sd-card-text">2</p></td>
<td><p class="sd-card-text">Can black castle queenside?</p></td>
<td><p class="sd-card-text">Non-positional, all ones or all zeros</p></td>
</tr>
<tr class="row-odd"><td><p class="sd-card-text">3</p></td>
<td><p class="sd-card-text">Can black castle kingside?</p></td>
<td><p class="sd-card-text">Non-positional, all ones or all zeros</p></td>
</tr>
<tr class="row-even"><td><p class="sd-card-text">4</p></td>
<td><p class="sd-card-text">Is white or black observing?</p></td>
<td><p class="sd-card-text">Non-positional, all ones(black) or all zeros(white)</p></td>
</tr>
<tr class="row-odd"><td><p class="sd-card-text">5</p></td>
<td><p class="sd-card-text">50 move rule count.</p></td>
<td><p class="sd-card-text">One in position of 8x8 matrix flattened to 1 dimension</p></td>
</tr>
<tr class="row-even"><td><p class="sd-card-text">6</p></td>
<td><p class="sd-card-text">All ones.</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p class="sd-card-text">7</p></td>
<td><p class="sd-card-text">Where are the observer’s pawns?</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p class="sd-card-text">8</p></td>
<td><p class="sd-card-text">Where are the observer’s knights?</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p class="sd-card-text">9</p></td>
<td><p class="sd-card-text">Where are the observer’s bishops?</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p class="sd-card-text">10</p></td>
<td><p class="sd-card-text">Where are the observer’s rooks?</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p class="sd-card-text">11</p></td>
<td><p class="sd-card-text">Where are the observer’s queens?</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p class="sd-card-text">12</p></td>
<td><p class="sd-card-text">Where is the observer’s king?</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p class="sd-card-text">13</p></td>
<td><p class="sd-card-text">Where are the opponent’s pawns?</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p class="sd-card-text">14</p></td>
<td><p class="sd-card-text">Where are the opponent’s knights?</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p class="sd-card-text">15</p></td>
<td><p class="sd-card-text">Where are the opponent’s bishops?</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p class="sd-card-text">16</p></td>
<td><p class="sd-card-text">Where are the opponent’s rooks?</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p class="sd-card-text">17</p></td>
<td><p class="sd-card-text">Where are the opponent’s queens?</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p class="sd-card-text">18</p></td>
<td><p class="sd-card-text">Where is the opponent’s king?</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p class="sd-card-text">19</p></td>
<td><p class="sd-card-text">Has this position been seen before?</p></td>
<td><p class="sd-card-text">Non-positional, all ones or all zeros</p></td>
</tr>
<tr class="row-even"><td><p class="sd-card-text">20-110</p></td>
<td><p class="sd-card-text">Repeats of 7-19 for the 7 most
recent positions.</p></td>
<td><p class="sd-card-text">From most recent to least.</p></td>
</tr>
</tbody>
</table>
</div>
</details><p>To create the database then is a matter of submitting the moves described in the
PGN file to the environment, saving observations with appropriate labels all the
while.</p>
<a class="reference internal image-reference" href="../../_images/dataProcessing.png"><img alt="../../_images/dataProcessing.png" class="align-center" src="../../_images/dataProcessing.png" style="width: 467.95px; height: 243.95px;" />
</a>
<p>Further, the database is refined to concentrate on more relevant datapoints. On
advice provided by the <a class="reference external" href="https://arxiv.org/abs/1711.09667">DeepChess</a> <sup>1</sup>
paper, this includes avoiding positions very early in the game (first 5 moves),
positions immediately after the capture of a piece, and games which ended in a
draw.</p>
</section>
<section id="the-stats">
<h3>The Stats<a class="headerlink" href="#the-stats" title="Link to this heading">¶</a></h3>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Measure</p></th>
<th class="head"><p>Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Number of games processed</p></td>
<td><p>300,000</p></td>
</tr>
<tr class="row-odd"><td><p>Size of games processed</p></td>
<td><p>0.3 GB</p></td>
</tr>
<tr class="row-even"><td><p>Number of observations</p></td>
<td><p>5,875,812</p></td>
</tr>
<tr class="row-odd"><td><p>Size of labels</p></td>
<td><p>2.0 GB</p></td>
</tr>
<tr class="row-even"><td><p>Size of observations</p></td>
<td><p>69.0 GB</p></td>
</tr>
</tbody>
</table>
</section>
<section id="the-tricky-bit">
<h3>The Tricky Bit<a class="headerlink" href="#the-tricky-bit" title="Link to this heading">¶</a></h3>
<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3">
<summary class="sd-summary-title sd-card-header">
<span class="sd-summary-text">The Tricky Bit</span><span class="sd-summary-state-marker sd-summary-chevron-right"><svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-right" viewBox="0 0 24 24" aria-hidden="true"><path d="M8.72 18.78a.75.75 0 0 1 0-1.06L14.44 12 8.72 6.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018l6.25 6.25a.75.75 0 0 1 0 1.06l-6.25 6.25a.75.75 0 0 1-1.06 0Z"></path></svg></span></summary><div class="sd-summary-content sd-card-body docutils">
<p class="sd-card-text">The size of the database is considerable. This makes the games difficult to parse
and the observation data difficult to fit onto RAM all at once.</p>
<p class="sd-card-text">To address the difficulty of parsing over 1M games (necessary even when limiting
the database to 300,000 games to avoid draws), I created a custom iterator which
leverages python’s Pandas library. This iterator combined with a multiprocess
mapping ensures the database is created quickly with efficient use of compute
power and memory. Each process will save the observations to the hard drive
while accumulating observation label information in RAM up to some specified
limit (14,000 games in my case). The label information is then also saved to the
hard drive with a master file keeping track of which label files contain
the metadata for which observations (e.g. label_file_1 contains metadata for
the first 200,000 observations). This procedure allows the database to easily
scale, dependent on the available games supplied by PGN file, the available RAM,
and the available hard drive space.</p>
<p class="sd-card-text">This also addresses the second issue of fitting all observation data into RAM at
once. The label files which contain the metadata for the observations, including
their location on the hard drive, can then be loaded one at a time and have all
their observations processed before moving on to the next set of observations
represented by the next label file.</p>
<p class="sd-card-text">This is complicated somewhat by the idea that the GPU used to train our model
will be much faster at processing than the CPU loading data from the hard drive.
This means it is prudent to enable multiprocessing and batching when loading the
data to be trained on. To ensure RAM usage is stable:</p>
<ol class="arabic simple">
<li><p class="sd-card-text">Indices must be served in order. So if selected randomly, as with a data
split, those selected must be sorted.</p></li>
<li><p class="sd-card-text">Two label files should be in RAM, where one fails to complete a batch, the
next can take over.</p></li>
<li><p class="sd-card-text">Once the end of a label file is reached, a lock should be used to pause all
but one process which handles opening the next label file (and closing the
oldest one).</p></li>
<li><p class="sd-card-text">Since <a class="reference external" href="https://pytorch.org/docs/stable/index.html">Pytorch’s</a> dataloader is
being used, special considerations must be made in how data labels are stored,
avoiding lists and dicts, described in detail in my repo
<a class="reference external" href="https://mzimm003.github.io/Chess/build/html/_autosummary/my_chess.learner.datasets.dataset.Dataset.html">documentation</a>.</p></li>
</ol>
</div>
</details></section>
</section>
<section id="machine-learning-engineering">
<h2>Machine Learning Engineering<a class="headerlink" href="#machine-learning-engineering" title="Link to this heading">¶</a></h2>
<p>Now with the ability to create a database full of observations of some of the
best players (bots) in the world, we have a strong basis to support the
creation of our own chess bot. There are many machine learning approaches to
achieve a viable chess bot, so multiple will be explored.</p>
<p>The first will be an application of supervised learning. This is a
straight-forward use of the generated dataset, where the observations serve as
input to our model which then attempts to approximate labels also provided by
the database. The approximation attempts are graded, measuring their error, and
the model’s parameters are adjusted to improve.</p>
<section id="supervised-learning">
<h3>Supervised Learning<a class="headerlink" href="#supervised-learning" title="Link to this heading">¶</a></h3>
<p>The goal is to create a model capable of classifying a given position, or chess
board observation, as either winning or losing. More specifically, when
comparing two observations it should be able to deem which is winning and which
is losing. Then, incorporate this scheme as a heuristic evaluation for a classic
minimax game tree search. This effort is lead by the DeepChess <sup>1</sup> research
paper.</p>
<p><strong>Autoencoding-</strong> To start, a randomly initialized model, of any shape, will
know nothing about chess. It will know nothing about strategy, have no
expectation of how a game might play out, and not understand the interdependence
of pieces on the board. This will make classifying one board state as better
than another quite difficult. So, first a feature extractor, something that
does understand the intricacies of the game, will be useful to inform our
classifier.</p>
<p>Autoencoding is one way to create a competent feature extractor, without relying
on a lot of manual feature engineering. In short, the original observation
serves as input and the objective label. In between, a model which allows for
less and less information to be passed after each layer, and its mirror image.
The model then encodes the observation in a way meaningful enough that the
mirror image can decode and rebuild the original observation. If the observation
is rebuilt well, the features captured must be useful and relevant
representations of the game.</p>
<p>To help train, we initially avoid forcing the model to reconstitute the
observation from the fully condensed form. Instead, for each batch, we take a
slice of the model to first train the larger layers, closer to the size of the
observation. Then we train on the batch again, including the next layer of the
model, and so on until the entire model is included. This reinforces the idea
of gradually more abstract concepts being captured by the feature extractor as
the observation is processed deeper within the model.</p>
<figure class="align-center" id="id2">
<a class="reference internal image-reference" href="../../_images/autoencoder.png"><img alt="../../_images/autoencoder.png" src="../../_images/autoencoder.png" style="width: 679.0px; height: 423.0px;" />
</a>
<figcaption>
<p><span class="caption-text">Autoencoding training process per batch.</span><a class="headerlink" href="#id2" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p><strong>Classification-</strong></p>
<p><strong>MiniMax Search-</strong></p>
</section>
<section id="reinforcement-learning">
<h3>Reinforcement Learning<a class="headerlink" href="#reinforcement-learning" title="Link to this heading">¶</a></h3>
</section>
<section id="generative-model">
<h3>Generative Model<a class="headerlink" href="#generative-model" title="Link to this heading">¶</a></h3>
</section>
</section>
<section id="references">
<h2>References:<a class="headerlink" href="#references" title="Link to this heading">¶</a></h2>
<ol class="arabic simple">
<li><p>David, O., Netanyahu, N., &amp; Wolf, L. (2016). DeepChess: End-to-End Deep Neural Network for Automatic Learning in Chess. Springer International Publishing.</p></li>
</ol>
</section>
</section>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &#169;2024, Mark Zimmerman.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.0.2</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
      |
      <a href="../../_sources/projects/chessbot/chessbot.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>